<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Easy Notes | Your private notes</title>
    <link rel="icon" href="assets/images/Easy-Notes-Logo.png" type="image/x-icon">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f4f8;
        }

        #notes-list {
            padding: 20px;
        }

        #notes-list h1 {
            text-align: center;
        }

        #notes-list ul {
            list-style-type: none;
            padding: 0;
        }

        #notes-list li {
            background: white;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
        }

        #add-note-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #0066ff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 30px;
            cursor: pointer;
        }

        #note-editor {
            padding: 20px;
        }

        #note-title {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            box-sizing: border-box;
        }

        #note-content {
            width: 100%;
            height: 400px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            box-sizing: border-box;
        }

        #editor-toolbar {
    margin-top: 10px;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
}

#editor-toolbar > div,
#editor-toolbar > button {
    flex: 1;
    margin: 5px;
}

#editor-toolbar input[type="file"] {
    display: none;
}

#save-note-btn,
#back-to-list-main,
#editor-toolbar button {
    background-color: #0066ff;
    color: white;
    border: none;
    border-radius: 20px;
    padding: 10px 20px;
    cursor: pointer;
    font-size: 16px;
    margin: 5px 0;
}

#note-category {
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 20px;
    font-size: 16px;
    margin-left: 5px;
}

@media (max-width: 768px) {
    #editor-toolbar {
        flex-direction: column;
        align-items: stretch;
    }

    #editor-toolbar > div,
    #editor-toolbar > button {
        flex: none;
        margin: 10px 0;
        width: 100%;
    }

    #save-note-btn,
    #back-to-list-main,
    #editor-toolbar button {
        padding: 10px;
        font-size: 14px;
        width: 100%;
    }

    #note-category {
        width: 100%;
        margin-left: 0;
    }
}

        .note-actions {
            margin-top: 10px;
        }

        .note-actions button {
            margin-right: 5px;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #0066ff;
            color: white;
            border: none;
            border-radius: 20px;
        }

        #delete-confirm {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: none;
            width: 30%;
        }

        @media (max-width: 768px) {
            #delete-confirm {
                width: 65%;
            }
        }

        #delete-confirm p {
            margin-bottom: 20px;
        }

        #delete-confirm button {
            background-color: #0066ff;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            cursor: pointer;
            margin-right: 10px;
        }

        #delete-confirm button.cancel {
            background-color: #999;
        }

        #search-bar {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .category-tag {
    padding: 2px 8px;
    margin-right: 5px;
    border-radius: 3px;
    font-size: 12px;
    color: white; /* Text color for all categories */
}

.category-work {
    background-color: #0066ff; /* Blue for Work */
}

.category-personal {
    background-color: #66cc66; /* Light green for Personal */
}

.category-learn {
    background-color: #ffd700; /* Light yellow for Learn */
}


        .note-preview {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #note-detail {
            display: none;
            padding: 20px;
            background-color: white;
            border-radius: 5px;
            margin-top: 20px;
        }

        #note-detail h2 {
            margin-top: 0;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .image-preview {
            position: relative;
            display: inline-block;
        }

        .image-preview img {
            max-width: 150px;
            height: auto;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .delete-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: red;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .draggable {
            cursor: move;
        }

        #loading-page {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: white;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}
    </style>
</head>
<body>
    <div id="loading-page" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; justify-content: center; align-items: center; z-index: 9999;">
        <img src="assets/images/easy-notes-logo.png" alt="Logo" style="width: 200px; height: 200px;">
    </div>
    <div id="notes-list">
        <h1>Easy Notes</h1>
        <input type="text" id="search-bar" placeholder="Search Notes">
        <ul id="notes"></ul>
        <button id="add-note-btn">+</button>
    </div>
    <div id="note-editor" style="display: none;">
        <input type="text" id="note-title" placeholder="Note Title">
        <textarea id="note-content"></textarea>
        <div id="image-previews" class="image-preview-container"></div>
        <div id="editor-toolbar">
            <div>
                <input type="file" id="file-input" multiple>
                <button onclick="document.getElementById('file-input').click()">Upload</button>
            </div>
            <select id="note-category">                
                <option value="">Choose category</option>                
                <option value="Work">Work</option>                
                <option value="Personal">Personal</option>                
                <option value="Learn">Learn</option>            
            </select>
            <button id="save-note-btn">Save</button>
        </div>
        <button id="back-to-list-main">Back to List</button>
    </div>
    <div id="delete-confirm">
        <p>Are you sure you want to delete this note?</p>
        <button id="confirm-delete">Delete</button>
        <button class="cancel">Cancel</button>
    </div>
    <div id="note-detail">
        <h2 id="detail-title"></h2>
        <div id="detail-content"></div>
        <div class="note-actions">
            <button id="edit-note">Edit</button>
            <button id="delete-note">Delete</button>
            <button id="back-to-list">Back to List</button>
        </div>
    </div>
    <div id="cookie-consent" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 9999;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 20px; text-align: center; width: 260px; max-width: 300px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
        <h2>Cookies Consent</h2>
        <p>We use cookies to store your notes and enhance your experience on our website. By continuing to use our site, you accept our use of cookies. If you do not agree, you will not be able to use our full functionality.</p>
        <button id="accept-cookies" style="background-color: #0066ff; color: white; border: none; border-radius: 20px; padding: 10px 20px; cursor: pointer;">Accept</button>
        <button id="decline-cookies" style="background-color: #999; color: white; border: none; border-radius: 20px; padding: 10px 20px; cursor: pointer; margin-left: 10px;">Decline</button>
    </div>
</div>


    <script>
        const noteCategory = document.getElementById('note-category');
        const searchBar = document.getElementById('search-bar');
        const notesList = document.getElementById('notes');
        const addNoteBtn = document.getElementById('add-note-btn');
        const noteEditor = document.getElementById('note-editor');
        const notesListView = document.getElementById('notes-list');
        const saveNoteBtn = document.getElementById('save-note-btn');
        const noteContent = document.getElementById('note-content');
        const noteTitle = document.getElementById('note-title');
        const fileInput = document.getElementById('file-input');
        const noteDetail = document.getElementById('note-detail');
        const detailTitle = document.getElementById('detail-title');
        const detailContent = document.getElementById('detail-content');
        const editNoteBtn = document.getElementById('edit-note');
        const deleteNoteBtn = document.getElementById('delete-note');
        const backToListBtn = document.getElementById('back-to-list');
        const backToListMainBtn = document.getElementById('back-to-list-main');

        searchBar.addEventListener('input', () => {
            const searchTerm = searchBar.value.toLowerCase();
            const notes = document.querySelectorAll('#notes li');
        
            notes.forEach(note => {
                const noteText = note.textContent.toLowerCase();
                if (noteText.includes(searchTerm)) {
                    note.style.display = 'block';
                } else {
                    note.style.display = 'none';
                }
            });
        });
        
        function loadNotes() {
    const cookies = document.cookie.split(';');
    cookies.forEach(cookie => {
        const [name, value] = cookie.split('=');
        if (name.trim().startsWith('note_')) {
            const noteData = JSON.parse(decodeURIComponent(value));
            const li = createNoteListItem(noteData, name.trim());
            notesList.appendChild(li);
        }
    });
}


        function createNoteListItem(noteData, noteId) {
    const li = document.createElement('li');
    li.dataset.noteId = noteId;
    const categoryClass = noteData.category ? `category-${noteData.category.toLowerCase()}` : '';
    const categoryTag = noteData.category ? `<span class="category-tag ${categoryClass}">${noteData.category}</span>` : '';

    let fileTypeTags = '';
    if (noteData.files && noteData.files.length > 0) {
        const hasImage = noteData.files.some(file => file.content.startsWith('data:image'));
        const hasVideo = noteData.files.some(file => file.content.startsWith('data:video'));
        const hasOtherFile = noteData.files.some(file => !file.content.startsWith('data:image') && !file.content.startsWith('data:video'));

        if (hasImage) {
            fileTypeTags += '[Image] ';
        }
        if (hasVideo) {
            fileTypeTags += '[Video] ';
        }
        if (hasOtherFile) {
            fileTypeTags += '[File] ';
        }
    }

    li.innerHTML = `<strong>${noteData.title}</strong> ${categoryTag} <div class="note-preview">${noteData.content.substring(0, 50)} ${fileTypeTags}</div>`;
    li.addEventListener('click', () => {
        showNoteDetail(noteId, noteData);
    });
    return li;
}


        function saveNote() {
    const noteData = {
        title: noteTitle.value,
        content: noteContent.value,
        category: noteCategory.value,
        files: []
    };

    const noteId = noteTitle.dataset.noteId || `note_${Date.now()}`;

    const previewImages = imagePreviewsContainer.querySelectorAll('img');
    previewImages.forEach(img => {
        noteData.files.push({
            name: img.alt,
            content: img.src
        });
    });

    saveNoteToCookies(noteId, noteData);
}


        function saveNoteToCookies(noteId, noteData) {
    document.cookie = `${noteId}=${encodeURIComponent(JSON.stringify(noteData))}; expires=Tue, 19 Jan 2038 03:14:07 UTC; path=/`;
    const li = createNoteListItem(noteData, noteId);
    const existingLi = notesList.querySelector(`li[data-note-id="${noteId}"]`);
    if (existingLi) {
        existingLi.replaceWith(li);
    } else {
        notesList.appendChild(li);
    }
    showNotesList();
}

            window.onload = function() {
    if (!getCookie('cookiesAccepted')) {
        document.getElementById('cookie-consent').style.display = 'block';
    } else {
        document.getElementById('cookie-consent').style.display = 'none';
    }

    setTimeout(() => {
        document.getElementById('loading-page').style.display = 'none';
    }, 3500); 
}


    // Get cookie value by name
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }

    // Set cookie
    function setCookie(name, value, days) {
        const expires = new Date(Date.now() + days * 864e5).toUTCString();
        document.cookie = `${name}=${value}; expires=${expires}; path=/`;
    }

    // Accept cookies
    document.getElementById('accept-cookies').addEventListener('click', () => {
        setCookie('cookiesAccepted', 'true', 365);
        document.getElementById('cookie-consent').style.display = 'none';
    });

    // Decline cookies
    document.getElementById('decline-cookies').addEventListener('click', () => {
        window.close();
    });

        
        function showNotesList() {
            noteEditor.style.display = 'none';
            notesListView.style.display = 'block';
            noteDetail.style.display = 'none';
            searchBar.style.display = 'block';
        }

        function showNoteEditor(noteId = null, noteData = null) {
            noteTitle.dataset.noteId = noteId || '';
            noteTitle.value = noteData?.title || '';
            noteContent.value = noteData?.content || '';
            noteCategory.value = noteData?.category || '';
            noteEditor.style.display = 'block';
            notesListView.style.display = 'none';
            noteDetail.style.display = 'none';
            searchBar.style.display = 'none';
        }

        function showNoteDetail(noteId, noteData) {
    detailTitle.textContent = noteData.title;
    detailContent.innerHTML = noteData.content.replace(/\n/g, '<br>');
    detailContent.innerHTML += '<br>';  // Add a line break for separation

    if (noteData.files) {
        noteData.files.forEach(file => {
            const fileTag = document.createElement('div');
            if (file.content.startsWith('data:image')) {
                const img = document.createElement('img');
                img.src = file.content;
                img.alt = file.name;
                fileTag.appendChild(img);
            } else if (file.content.startsWith('data:video')) {
                fileTag.textContent = '[Video]';
            } else {
                fileTag.textContent = '[File]';
            }
            detailContent.appendChild(fileTag);
        });
    }

    noteDetail.dataset.noteId = noteId;
    noteEditor.style.display = 'none';
    notesListView.style.display = 'none';
    noteDetail.style.display = 'block';
    searchBar.style.display = 'none';
}

        function deleteNote() {
            const noteId = noteDetail.dataset.noteId;
            document.cookie = `${noteId}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
            const noteLi = notesList.querySelector(`li[data-note-id="${noteId}"]`);
            if (noteLi) {
                noteLi.remove();
            }
            document.getElementById('delete-confirm').style.display = 'none';
            showNotesList();
        }

        addNoteBtn.addEventListener('click', () => showNoteEditor());
        saveNoteBtn.addEventListener('click', saveNote);
        backToListMainBtn.addEventListener('click', showNotesList);
        editNoteBtn.addEventListener('click', () => {
            const noteId = noteDetail.dataset.noteId;
            const cookies = document.cookie.split(';');
            let noteData = null;
            cookies.forEach(cookie => {
                const [name, value] = cookie.split('=');
                if (name.trim() === noteId) {
                    noteData = JSON.parse(decodeURIComponent(value));
                }
            });
            showNoteEditor(noteId, noteData);
        });
        deleteNoteBtn.addEventListener('click', () => {
            document.getElementById('delete-confirm').style.display = 'block';
        });
        document.getElementById('confirm-delete').addEventListener('click', deleteNote);
        document.querySelector('#delete-confirm .cancel').addEventListener('click', () => {
            document.getElementById('delete-confirm').style.display = 'none';
        });
        backToListBtn.addEventListener('click', showNotesList);

        loadNotes();

        const imagePreviewsContainer = document.getElementById('image-previews');

        fileInput.addEventListener('change', handleFileSelect);

        function handleFileSelect(event) {
            const files = event.target.files;
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (function(file) {
                    return function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.alt = file.name;
                        img.classList.add('draggable');
                        
                        const imgContainer = document.createElement('div');
                        imgContainer.classList.add('image-preview');
                        
                        const deleteBtn = document.createElement('button');
                        deleteBtn.textContent = 'Ã—';
                        deleteBtn.classList.add('delete-image');
                        deleteBtn.addEventListener('click', function() {
                            imgContainer.remove();
                        });

                        imgContainer.appendChild(img);
                        imgContainer.appendChild(deleteBtn);
                        imagePreviewsContainer.appendChild(imgContainer);
                        
                        // Make image draggable
                        makeDraggable(imgContainer);
                    };
                })(file);
                reader.readAsDataURL(file);
            });
        }

        function makeDraggable(element) {
            element.addEventListener('dragstart', handleDragStart, false);
            element.addEventListener('dragover', handleDragOver, false);
            element.addEventListener('drop', handleDrop, false);
        }

        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = this;
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault(); // Necessary. Allows us to drop.
            }
            e.dataTransfer.dropEffect = 'move';  // See the section on the DataTransfer object.
            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation(); // Stops some browsers from redirecting.
            }

            // Don't do anything if dropping the same image we're dragging.
            if (draggedElement != this) {
                const parent = this.parentNode;
                parent.insertBefore(draggedElement, this.nextSibling);
            }

            return false;
        }
        
        // Ensure draggable elements are correctly marked
        function updateDraggableElements() {
            const previews = imagePreviewsContainer.querySelectorAll('.image-preview');
            previews.forEach(preview => {
                makeDraggable(preview);
            });
        }

        // Call updateDraggableElements initially and whenever the DOM changes
        updateDraggableElements();
    </script>
</body>
</html>
